# CivicResolve Setup Guide

Get the CivicResolve backend running on your local machine.

---

## Prerequisites

| Requirement | Version         | Notes                                     |
|-------------|-----------------|-------------------------------------------|
| Python      | 3.11+           | Specified in `render.yaml`                |
| pip         | Latest          | Python package manager                    |
| Git         | Latest          | For cloning the repository                |

---

## Installation

### 1. Clone the Repository

```bash
git clone https://github.com/your-username/CivicResolve.git
cd CivicResolve
```

### 2. Create Virtual Environment

```bash
python -m venv venv
```

**Activate the environment:**

```bash
# Linux / macOS
source venv/bin/activate

# Windows
venv\Scripts\activate
```

### 3. Install Dependencies

```bash
pip install -r requirements.txt
```

This installs:
- **Flask** — Web framework
- **Flask-SQLAlchemy** — Database ORM
- **Flask-CORS** — Cross-Origin Resource Sharing
- **gunicorn** — Production WSGI server
- **ultralytics** — YOLO AI model framework
- **opencv-python-headless** — Image processing
- **torch, torchvision** — PyTorch for AI inference
- **psycopg2-binary** — PostgreSQL adapter (optional)

---

## Model Weights

The AI detection feature requires a trained YOLO model.

### Location

```
ai_ml/models/best_civic_model.pt
```

### Setup

> [!IMPORTANT]
> **Ensure the model file is present before running the server.** If missing, the `/api/ai/predict` endpoint will return a `503` error.

The model file should already exist in the repository. If you've trained a custom model, replace `best_civic_model.pt` with your trained weights.

---

## Environment Variables

CivicResolve uses environment variables for configuration. Create a `.env` file in the project root:

```bash
cp .env.example .env
```

### Available Variables

| Variable      | Description                    | Default           |
|---------------|--------------------------------|-------------------|
| `SECRET_KEY`  | Flask secret key               | `dev-secret-key`  |
| `PORT`        | Server port                    | `5000`            |
| `FLASK_ENV`   | Environment mode               | `development`     |

> [!NOTE]
> The default configuration uses **SQLite** (`database/civicresolve.db`), which requires no additional setup.

---

## Database Setup

The database is automatically created on first run. Tables are generated by Flask-SQLAlchemy.

**Database location:**
```
database/civicresolve.db
```

---

## Running the Application

### Development Mode

```bash
python -m backend.app
```

Server starts at: `http://localhost:5000`

### Production Mode (Gunicorn)

```bash
./run.sh
```

Or manually:

```bash
export PYTHONPATH="$(pwd):$PYTHONPATH"
gunicorn backend.app:app --bind 0.0.0.0:5000 --workers 2 --timeout 120
```

---

## Project Structure

```
CivicResolve/
├── backend/
│   ├── app.py              # Main Flask application
│   ├── config.py           # Configuration settings
│   ├── models.py           # Database models
│   ├── routes/             # API endpoints
│   │   ├── citizen_routes.py
│   │   ├── admin_routes.py
│   │   ├── ai_routes.py
│   │   └── workflow/       # Task management routes
│   └── utils/              # Helper utilities
├── ai_ml/
│   └── models/             # AI model weights
├── data/
│   └── images/             # Uploaded images
├── database/               # SQLite database
├── requirements.txt
├── run.sh                  # Production startup script
└── docs/
```

---

## Verification

After setup, verify the installation:

```bash
curl http://localhost:5000/
```

Expected response:
```json
{
  "message": "CivicResolve Backend is Running!",
  "status": "online"
}
```

---

## Troubleshooting

| Issue                          | Solution                                                |
|--------------------------------|---------------------------------------------------------|
| Model not found error          | Ensure `ai_ml/models/best_civic_model.pt` exists        |
| Port already in use            | Change `PORT` in `.env` or kill the process             |
| Import errors                  | Set `PYTHONPATH` to project root                        |
| Database permission errors     | Ensure `database/` directory is writable                |
